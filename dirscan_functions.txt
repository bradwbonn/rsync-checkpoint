Types of queries to check file sync status:

1. Number of files indexed during a scan:
    -> Updates while scan is in operation
    -> Compare a count between source and destination (simplest update check)
    -> Use same M/R view as #3
2. Latest scan job status for a host
    -> single-doc access using primary key
    -> Shows latest scan document by hostID
    -> show time difference between scan completion times
    -> Updates when scans complete
3. Determine a sync completion percentage based on scan total size and count of non-stale, non-orphaned files against source files
    -> M/R view:
        -> only "file" docs with goodscan=true and source=false
        -> "For each doc:
            -> emit key=[<scanID>,<orphaned>,<stale>] value=<size>
            -> reduce _stats()
4. Determine if a scan is running by checking view for most recent scanID in files?  Check against latest completed scanID?
        
5. Search for scanned files by name
    -> search index on filename
5. Search for hosts by name
    -> search index on hostname
    
6. Report on file types for a particular scan (most current by default)
    -> M/R view
        only "file" docs with goodscan=true.
        If "extension" == null, use "unknown", otherwise use value of "extension"
        emit key=[<scanID>,<filetype>] value=<size>
        reduce _stats()
        
7. Search for existing host
    -> search index on host friendly name

8. Search for existing relationship
    -> Use host ID's,dirIDs in M/R view to find. Can decrease group level for 
       only "relationship" docs
        emit key=[<sourcehost>,<targethost>,<sourcedir>,<targetdir>] value=null
    
 File document (per-diem database based on scan start time)
 ID: <40-char-sha1-hash-of:host,filename,path><ScanDateAsUTCtimestamp>
 Fields:
  "filename": <case_sensitive_name_of_file>
  "path": [relative,path,to,file,on,local,system,under,sync,directory]
  "host": <ID of matching host doc>
  "size": <size in bytes of file>
  "permissionsUNIX": <UNIX-style_permission_flag_code>  (i.e. 755)
  "permissionsother": (i.e. rwr-r-)
  "datemodified": <UTC timestamp of file last written>
  "owner": <local_UNIX_user_owner>
  "group": <local_UNIX_group_owner>
  "datescanned": <UTC Timestamp of when file doc is created>
  "relationship": <relationshipID>
  "scanID": <ID of scan job that last checked it>
  "type": "file"
  "goodscan": <true/false>
  "checksum": <file checksum based on contents>  #Only used if ultra-check in place
  "source": <true/false>  (true if directory being scanned is the source of the mirror)
  "hidden": <true/false> (use for dotfiles or dotdirs) # NOT IN USE CURRENTLY
  "orphaned": <"yes"/"no"/"unknown"> (If source file, always "no")
            ON A DESTINATION REPLICA: (source=false)
                If, the UTC Timestamp of asc=false,limit=1 of the source file ID queried is >= last successful scan,
                    then orphaned=no,
                If the UTC timestamp is < last successful COMPLETED scan ID, then orphaned="yes"
                If the file returns as non-existent in the database based on that ID (in other words, the string returned
                    does not match the startkey sent to the query), then orphaned="unknown"
  "stale": <true/false>  Check the scanned file's modified date against the most recent source version. If source is newer,
                    OR if the latest source scan is older than <threshold>, then stale=true, otherwise stale=false.
                    If file is orphaned, skip this check and set stale=true

 Scan document (main database)
 ID: <GUID>
 Fields:
  "type": "scan"
  "started: <UTC timestamp when scan began>
  "ended": <UTC timestamp when scan completed> (empty if still running)
  "database": <per-diem database used for scan results>
  "success": <true/false> (false means usually error reading files in dir structure or scan aborted)
  "errorcount": <number of errors encountered during scan>
  "hostID": <ID of matching host doc>
  "directory": <path the script is set to scan>
  "directorysize": <total size of directory in bytes> (product of du -s)
  "relationship": <relationshipID>
  "firstscan": <true/false>
  "previousscanID": <ID of scan that went before this one>
  "source": <true/false>
  "filecount": <total files scanned>

 Host document (main database)
 ID: <GUID>
 Fields:
  "type": "host"
  "hostname": <user-friendly host name of system>
  "ip4": <IPv4 address of system>
  "ip6": <IPv6 address of system>
  
 Relationship document (main database)
 ID: <GUID>
 Fields:
  "type": "relationship"
  "name": <friendly name for relationship>
  "sourcehost": <source HostID>
  "targethost": <target HostID>
  "sourcedir": <source directory or module>
  "targetdir": <target directory or module>
  "active": <true/false> # Not currently used
  "rsyncflags": ["flag1","flag2",...]
  "excludedfiles": ["string1","string2","string3"]

Configuration file JSON:
{
	‘auth’ = <Cloudant Auth String>,
	‘cloudant_user’ = <Cloudant account name>,
	‘relationship’ = <ID of host relationship>,
	‘host_id’ = <ID of host this file is for>,
	‘threshold’ = <number of docs per bulk post>
	‘maindbname’ = <name of central sync database> # Currently not used
}
  
